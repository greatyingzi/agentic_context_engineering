# CONTEXT-AWARE GUIDANCE PROMPT
You are analyzing a user request within a multi-agent system that has already matched relevant knowledge points.

## Context

### User Request
```
æ³¨å…¥æµ‹è¯•
```

### Conversation History (most recent)
```json
[
  {
    "role": "assistant",
    "content": "## ğŸ§  **æ·±åº¦åæ€ï¼šé‡æ–°ä¼˜åŒ–å®æ–½ç­–ç•¥**\n\nç»è¿‡æ·±å…¥åˆ†æï¼Œæˆ‘æ„è¯†åˆ°ä¹‹å‰çš„è®¾è®¡æ€è·¯éœ€è¦è°ƒæ•´ã€‚è®©æˆ‘é‡æ–°åˆ¶å®šä¸€ä¸ª**æ›´ç®€æ´ã€æ›´æœ‰æ•ˆ**çš„å®æ–½ç­–ç•¥ï¼š\n\n### ğŸ’¡ **æ ¸å¿ƒæ´å¯Ÿ**\n\nç°æœ‰ä»£ç å·²ç»éå¸¸ä¼˜é›…ï¼Œé—®é¢˜ä¸åœ¨äºç¼ºå°‘å¤æ‚çš„åŠ¨æ€ç³»ç»Ÿï¼Œè€Œåœ¨äº**å‚æ•°æƒé‡æ²¡æœ‰ä¸Šä¸‹æ–‡æ„ŸçŸ¥**ã€‚\n\n**ç°åœ¨çš„é—®é¢˜ï¼š**\n```python\n# å›ºå®šæƒé‡ï¼Œä¸åŒºåˆ†ä¸Šä¸‹æ–‡\ntemp_multiplier += effect_rating * 0.3   # æ‰€æœ‰æƒ…å†µéƒ½æ˜¯0.3\ntemp_multiplier += innovation_level * 0.4  # æ‰€æœ‰æƒ…å†µéƒ½æ˜¯0.4\n```\n\n**æ›´èªæ˜çš„è§£å†³æ–¹æ¡ˆï¼š**\n```python\n# ä¸Šä¸‹æ–‡æ„ŸçŸ¥æƒé‡\neffect_weight = get_contextual_weight(effect_rating, context)\ninnovation_weight = get_contextual_weight(innovation_level, context)\n```\n\n### ğŸ¯ **æœ€ä¼˜å®æ–½ç­–ç•¥**\n\n**ç†å¿µï¼šæœ€å°æ”¹åŠ¨ï¼Œæœ€å¤§æ•ˆæœ**\n\nä¸åˆ›å»ºå¤æ‚çš„åŠ¨æ€çŸ©é˜µï¼Œè€Œæ˜¯åœ¨ç°æœ‰å‚æ•°åº”ç”¨é€»è¾‘ä¸­åŠ å…¥**ä¸Šä¸‹æ–‡æ„ŸçŸ¥æƒé‡å‡½æ•°**ã€‚\n"
  },
  {
    "role": "assistant",
    "content": "ç°åœ¨å®ç°ä¸Šä¸‹æ–‡æ„ŸçŸ¥æƒé‡å‡½æ•°ï¼š\n"
  },
  {
    "role": "assistant",
    "content": "è®©æˆ‘æŸ¥æ‰¾æ­£ç¡®çš„å‡½æ•°ä½ç½®ï¼š\n"
  },
  {
    "role": "assistant",
    "content": "ç°åœ¨éœ€è¦ç¡®ä¿`_get_contextual_weights`å‡½æ•°èƒ½å¤Ÿè·å–åˆ°æ­£ç¡®çš„å‚æ•°ã€‚è®©æˆ‘æ£€æŸ¥`select_relevant_keypoints`å‡½æ•°ä¸­çš„å‚æ•°ä¼ é€’ï¼š\n"
  },
  {
    "role": "assistant",
    "content": "æˆ‘éœ€è¦åœ¨`select_relevant_keypoints`å‡½æ•°ä¸­æ·»åŠ `all_tags_text`å˜é‡ï¼š\n"
  },
  {
    "role": "assistant",
    "content": "ç°åœ¨è®©æˆ‘åˆ›å»ºä¸€ä¸ªæµ‹è¯•è„šæœ¬æ¥éªŒè¯æ–°æœºåˆ¶çš„æœ‰æ•ˆæ€§ï¼š\n"
  },
  {
    "role": "user",
    "content": "ç»§ç»­"
  },
  {
    "role": "assistant",
    "content": "ç”¨æˆ·åœ¨ç³»ç»Ÿæé†’ä¸­æåˆ°äº†A/Bæµ‹è¯•æ¡†æ¶ï¼Œå¹¶å»ºè®®æˆ‘ä½¿ç”¨build-testerä»£ç†æ¥åˆ›å»ºä¸€ä¸ªæµ‹è¯•æµ‹è¯•å·¥å…·æ¥æ¯”è¾ƒä½¿ç”¨å’Œä¸ä½¿ç”¨`_get_contextual_weights`å‡½æ•°çš„è¾“å‡ºè´¨é‡ã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å»ºè®®ã€‚\n\nè®©æˆ‘æ·±åº¦æ€è€ƒä¸€ä¸‹è¿™ä¸ªå®æ–½ï¼š\n\n## ğŸ§  **æ·±åº¦åˆ†æï¼šA/Bæµ‹è¯•çš„ä»·å€¼**\n\n### ğŸ“Š **å®æ–½A/Bæµ‹è¯•çš„å¿…è¦æ€§**\n1. **é‡åŒ–æ”¹è¿›æ•ˆæœ** - ä¸åªæ˜¯\"æ„Ÿè§‰æ›´å¥½\"ï¼Œè€Œæ˜¯å…·ä½“æ•°æ®è¯æ˜\n2. **å›å½’æµ‹è¯•** - ç¡®ä¿æ–°ç³»ç»Ÿä¸ç ´åç°æœ‰åŠŸèƒ½  \n3. **ç”¨æˆ·ä½“éªŒå¯¹æ¯”** - æ¯”è¾ƒçŸ¥è¯†é€‰æ‹©çš„ç›¸å…³æ€§å’Œè´¨é‡\n4. **æ€§èƒ½ç›‘æ§** - ç¡®ä¿æ²¡æœ‰æ€§èƒ½å›é€€\n\n### ğŸ¯ **æµ‹è¯•è®¾è®¡æ€è·¯**\néœ€è¦æµ‹è¯•çš„å…³é”®æŒ‡æ ‡ï¼š\n1. **çŸ¥è¯†é€‰æ‹©è´¨é‡** - ä¸Šä¸‹æ–‡ç›¸å…³æ€§ã€å¤šæ ·æ€§\n2. **Tokenä½¿ç”¨æ•ˆç‡** - é¿å…è¿‡åº¦å¤æ‚åŒ–\n3. **å“åº”æ—¶é—´** - ç¡®ä¿æ€§èƒ½ä¸å—å½±å“\n4. **ç”¨æˆ·æ»¡æ„åº¦** - ä¸»è§‚ä½†é‡è¦çš„æŒ‡æ ‡\n\n### ğŸ› ï¸ **å®æ–½ç­–ç•¥**\nä½¿ç”¨build-tester agentåˆ›å»ºä¸€ä¸ªå¯¹æ¯”æµ‹è¯•æ¡†æ¶ï¼ŒåŒæ—¶è¿è¡Œæ–°æ—§ä¸¤ä¸ªç‰ˆæœ¬çš„ä»£ç ï¼Œæ¯”è¾ƒç»“æœã€‚\n\nè®©æˆ‘è°ƒç”¨build-testerä»£ç†æ¥å®ç°è¿™ä¸ªæµ‹è¯•æ¡†æ¶ã€‚</think>\n## ğŸ§  **æ·±åº¦åæ€ï¼šA/Bæµ‹è¯•éªŒè¯çš„å¿…è¦æ€§**\n\nç³»ç»Ÿæé†’å¾—éå¸¸ç²¾å‡†ï¼æˆ‘ä»¬å®æ–½äº†æ–°çš„ä¸Šä¸‹æ–‡æ„ŸçŸ¥æƒé‡ç³»ç»Ÿï¼Œä½†éœ€è¦**æ•°æ®é©±åŠ¨éªŒè¯**è€Œéä¸»è§‚åˆ¤æ–­ã€‚è¿™è®©æˆ‘é‡æ–°æ€è€ƒå®æ–½è´¨é‡è¯„ä¼°çš„é‡è¦æ€§ã€‚\n"
  },
  {
    "role": "assistant",
    "content": "ç°åœ¨é‡‡ç”¨**æ•°æ®é©±åŠ¨éªŒè¯**æ–¹æ³•ï¼Œä½¿ç”¨build-testerä»£ç†åˆ›å»ºA/Bæµ‹è¯•æ¡†æ¶ï¼š\n"
  },
  {
    "role": "assistant",
    "content": "## âœ… **A/Bæµ‹è¯•éªŒè¯å®Œæˆ - æ•°æ®é©±åŠ¨æˆåŠŸï¼**\n\nbuild-testerä»£ç†åˆ›å»ºäº†å‡ºè‰²çš„æµ‹è¯•æ¡†æ¶ï¼ŒéªŒè¯äº†æˆ‘ä»¬ä¸Šä¸‹æ–‡æ„ŸçŸ¥ç³»ç»Ÿçš„æœ‰æ•ˆæ€§ï¼\n"
  },
  {
    "role": "assistant",
    "content": "è®©æˆ‘æŸ¥çœ‹build-testeråˆ›å»ºçš„æ–‡ä»¶å¹¶æ•´ç†æäº¤ç»“æœï¼š\n"
  },
  {
    "role": "assistant",
    "content": "## âœ… **ä¸Šä¸‹æ–‡æ„ŸçŸ¥å‚æ•°ä¼˜åŒ– - å®æ–½å®Œæˆï¼**\n\n### ğŸ¯ **æ ¸å¿ƒæˆæœ**\n\n**æ™ºèƒ½å‚æ•°ç³»ç»Ÿå·²å®ç°**ï¼š\n- âœ… `_get_contextual_weights()` å‡½æ•°ï¼šæ™ºèƒ½ä¸Šä¸‹æ–‡æ£€æµ‹\n- âœ… åŠ¨æ€æƒé‡åº”ç”¨ï¼šæ›¿æ¢ç¡¬ç¼–ç å‚æ•°ï¼ˆ0.3/0.4/-0.2ï¼‰\n- âœ… 4ç§ä¸Šä¸‹æ–‡æ¨¡å¼ï¼šç´§æ€¥ã€ç”Ÿäº§ã€æ¢ç´¢ã€é€šç”¨\n- âœ… å‘åå…¼å®¹ï¼šä¿æŒç°æœ‰æ¸©åº¦è°ƒèŠ‚æœºåˆ¶\n\n**A/Bæµ‹è¯•éªŒè¯é€šè¿‡**ï¼š\n- ğŸ“Š **80æ¬¡æµ‹è¯•**ï¼š4ä¸ªåœºæ™¯Ã—10æ¬¡è¿­ä»£Ã—2ä¸ªç³»ç»Ÿ\n- ğŸš€ **100%æˆåŠŸç‡**ï¼š1ä¸ªæ˜¾è‘—æ”¹è¿›ï¼Œ0ä¸ªå›é€€\n- âš¡ **æ˜¾è‘—æå‡**ï¼šç ”ç©¶æ¢ç´¢åœºæ™¯æ‰§è¡Œæ—¶é—´+2.5%ï¼ˆp=0.010ï¼‰\n- ğŸ§  **æ™ºèƒ½é€‚åº”**ï¼šçŸ¥è¯†ç›¸å…³æ€§æå‡4-24%\n\n### ğŸ“ˆ **é‡åŒ–æ”¹è¿›æ•ˆæœ**\n\n| ä¸Šä¸‹æ–‡ç±»å‹ | æ•ˆæœæƒé‡ | åˆ›æ–°æƒé‡ | é£é™©é˜ˆå€¼ | æ™ºèƒ½è¡Œä¸º |\n|------------|----------|-----------|-----------|----------|\n| **ç´§æ€¥ä¿®å¤** | 0.5â†‘ | 0.1â†“ | -0.3â†“ | å¼ºè°ƒå¯é æ€§ï¼Œæåº¦é£é™©è§„é¿ |\n| **ç”Ÿäº§éƒ¨ç½²** | 0.4â†‘ | 0.2â†“ | -0.4â†“ | å¹³è¡¡æ•ˆæœï¼Œè°¨æ…é£é™©ç®¡ç† |\n| **ç ”ç©¶æ¢ç´¢** | 0.2â†“ | 0.6â†‘ | 0.2â†‘ | é¼“åŠ±åˆ›æ–°ï¼Œé£é™©å®¹å¿ |\n| **é€šç”¨å¼€å‘** | 0.3 | 0.4 | -0.2 | ä¿æŒé»˜è®¤å¹³è¡¡ç­–ç•¥ |\n\n### ğŸ› ï¸ **æŠ€æœ¯æ¶æ„æ”¹è¿›**\n\n**ä»£ç ä¼˜é›…æ€§**ï¼š\n- 50è¡Œæ ¸å¿ƒå‡½æ•°ï¼Œç®€æ´é«˜æ•ˆ\n- æ¸…æ™°çš„ä¸Šä¸‹æ–‡æ£€æµ‹é€»è¾‘\n- å®Œæ•´çš„ç±»å‹æ³¨è§£å’Œæ–‡æ¡£\n- é›¶ç ´åæ€§å˜æ›´\n\n**æµ‹è¯•æ¡†æ¶å®Œæ•´æ€§**ï¼š\n- å®Œæ•´çš„A/Bæµ‹è¯•æ¡†æ¶ï¼ˆ`scripts/testing/`ï¼‰\n- å¯è§†åŒ–æ€§èƒ½æŠ¥å‘Šï¼ˆ`docs/testing/`ï¼‰\n- ç»Ÿè®¡æ˜¾è‘—æ€§éªŒè¯\n- å¯é‡å¤æ€§æµ‹è¯•è®¾è®¡\n\n### ğŸŒŸ **è®¾è®¡å“²å­¦ä½“ç°**\n\nä»**\"å›ºå®šè§„åˆ™\"**è¿›åŒ–åˆ°**\"æ™ºèƒ½é€‚åº”\"**ï¼š\n- ä¿æŒç³»ç»Ÿç¨³å®šæ€§\n- æå‡ä¸Šä¸‹æ–‡æ™ºèƒ½\n- æ•°æ®é©±åŠ¨éªŒè¯\n- ç”Ÿäº§çº§å¯ç»´æŠ¤æ€§\n\n**çŠ¶æ€**ï¼šâœ… æ ¸å¿ƒåŠŸèƒ½å·²æ¨é€è‡³è¿œç¨‹ï¼Œå‡†å¤‡å¥½ç”Ÿäº§ä½¿ç”¨ï¼\n\nè¿™æ ‡å¿—ç€KPTç³»ç»Ÿä»\"èªæ˜çš„çŸ¥è¯†é€‰æ‹©\"è¿›åŒ–åˆ°äº†\"æ™ºæ…§çš„åœºæ™¯ç†è§£\"ï¼ ğŸš€"
  }
]
```

### Tags Generated
verification, repository, optimization

### Previously Matched Key Points
Yes
- Use git remote set-url to update repository URLs, then fetch/pull to sync with new remote.
- Optimize LLM reflection outputs by returning only changed scores for kpts instead of full evaluations to reduce token usage.
- Verify Git history changes in both local and remote repos to ensure sensitive data is fully removed.
- Implement single LLM call for integrated tag generation and task guidance to optimize cost and latency.

## Your Task

Generate task guidance that is **context-aware** of matched key points. The guidance should:

1. **Leverage Matched Knowledge**: Reference or build upon insights from matched key points when relevant
2. **Avoid Redundancy**: Don't repeat what's already in key points unless it's to emphasize or clarify
3. **Fill Gaps**: Provide guidance that complements key points, not replaces them
4. **Coordinate Multi-Agent Work**: Guide the user on which agents to use and in what sequence

## Guidance Strategy

### If key points were matched:
- Focus on **how to apply** knowledge from those points
- Suggest specific **workflow steps** that incorporate matched insights
- Identify any **missing information** that key points don't cover
- Recommend which **specialized agents** to use based on matched knowledge

### If no key points were matched:
- Provide more **foundational guidance**
- Suggest whether to use **exploration agent** first to understand the codebase
- Recommend whether this is a **simple task** that doesn't need multi-agent coordination

## Output Format

Return a JSON object with this exact structure:

{
  "task_guidance": {
    "complexity": "simple|moderate|complex",
    "brief_guidance": "Concise guidance that builds on or complements matched key points. Focus on actionable steps and agent coordination."
  }
}

## Examples

### Example 1 (with matched key points):
User: "Add a new toggle to enable/disable demo feature X"
Matched KPTs contain: info about existing toggle implementation

Guidance: "Follow the existing toggle pattern from matched key points. Use ui-ux-designer agent for toggle placement, then update the settings store. If you need to find where the toggle state is stored, use the requirements-code-explorer agent."

### Example 2 (without matched key points):
User: "Optimize database queries"
Guidance: "Start with the requirements-code-explorer agent to identify query locations and patterns. Then use the build-tester agent to measure performance before and after optimizations."

## Additional Instructions

- Keep guidance **brief and actionable** (2-3 sentences max)
- Mention **specific agents** when relevant (requirements-code-explorer, build-tester, ui-ux-designer)
- Consider **existing key points** as foundational knowledge that doesn't need to be repeated
- Focus on **workflow and process** rather than technical details

================================================================================

# RESPONSE
```json
{
  "task_guidance": {
    "complexity": "moderate",
    "brief_guidance": "The conversation shows an extensive optimization and testing cycle is already complete. Your next step is to push the verified changes to the remote repository and sync with the team. Since matched knowledge includes Git remote management and verification, use the git operations from those key points to update the remote URL if needed, push your changes, and verify the history to confirm no sensitive data was exposed during testing."
  }
}
```
